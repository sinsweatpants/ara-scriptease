<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„ØªØ±Ù‚ÙŠÙ… Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ Ù„Ù„ØµÙØ­Ø§Øª</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background: #f0f0f0;
            margin: 0;
            padding: 20px;
        }

        .test-panel {
            background: white;
            padding: 20px;
            margin-bottom: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .input-area {
            width: 100%;
            height: 200px;
            font-family: 'Times New Roman', serif;
            font-size: 14px;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 4px;
            direction: rtl;
        }

        /* Pagination Styles */
        .screenplay-pages {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 20px;
            background-color: #f5f5f5;
            padding: 20px;
            min-height: 400px;
        }

        .page {
            width: 210mm;
            height: 297mm;
            background: white;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            position: relative;
            overflow: hidden;
            page-break-after: always;
        }

        .page-content {
            padding: 1in 1in 1in 1.5in;
            height: calc(297mm - 2in);
            overflow: hidden;
            direction: rtl;
            box-sizing: border-box;
            font-family: 'Amiri', 'Times New Roman', serif;
            font-size: 12pt;
            line-height: 1.5;
        }

        .page-number {
            position: absolute;
            bottom: 0.5in;
            left: 1in;
            font-size: 10pt;
            color: #666;
        }

        .page-overflow-indicator {
            position: absolute;
            bottom: 1in;
            right: 1.5in;
            background: rgba(255, 0, 0, 0.1);
            border: 1px dashed red;
            padding: 2px 4px;
            font-size: 8pt;
            color: red;
        }

        .page.overflow .page-overflow-indicator {
            display: block;
        }

        /* Element Styles */
        .basmala {
            text-align: left;
            margin: 0 0 2rem 0;
            font-weight: bold;
            font-size: 14pt;
        }

        .scene-header-container {
            width: 100%;
            margin-bottom: 20px;
            background: rgba(0, 100, 200, 0.1);
            padding: 10px;
            border-radius: 6px;
        }

        .scene-header-top-line {
            display: flex;
            justify-content: space-between;
            width: 100%;
            margin: 0;
            font-weight: bold;
        }

        .scene-header-3 {
            text-align: center;
            font-weight: bold;
            margin: 5px 0 0 0;
        }

        .action {
            text-align: right;
            margin: 1rem 0;
            font-size: 12pt;
        }

        .dialogue-block {
            margin: 15px 0;
            background: rgba(0, 200, 100, 0.1);
            padding: 15px;
            border-radius: 6px;
        }

        .character-name {
            text-align: center;
            font-weight: bold;
            text-transform: uppercase;
            margin: 0 auto;
            width: 2.5in;
        }

        .parenthetical {
            text-align: center;
            font-style: italic;
            margin: 0 auto;
            width: 2.0in;
        }

        .dialogue-text {
            text-align: center;
            margin: 0 auto 0.3rem auto;
            width: 2.5in;
            line-height: 1.2;
        }

        .transition {
            text-align: center;
            font-weight: bold;
            text-transform: uppercase;
            margin: 1rem 0;
            background: rgba(200, 100, 0, 0.1);
            padding: 10px;
        }

        .controls {
            display: flex;
            gap: 10px;
            margin: 10px 0;
        }

        button {
            padding: 8px 16px;
            border: 1px solid #ccc;
            background: #f9f9f9;
            border-radius: 4px;
            cursor: pointer;
        }

        button:hover {
            background: #e9e9e9;
        }

        .stats {
            background: #333;
            color: white;
            padding: 10px;
            border-radius: 4px;
            font-family: monospace;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <div class="test-panel">
        <h2>ğŸ”„ Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„ØªØ±Ù‚ÙŠÙ… Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ Ù„Ù„ØµÙØ­Ø§Øª</h2>
        <p>Ø£Ø¯Ø®Ù„ Ù†Øµ Ø§Ù„Ø³ÙŠÙ†Ø§Ø±ÙŠÙˆ Ø£Ø¯Ù†Ø§Ù‡ ÙˆØ§Ø®ØªØ¨Ø± Ø§Ù„ØªÙ‚Ø³ÙŠÙ… Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ Ù„Ù„ØµÙØ­Ø§Øª Ù…Ø¹ Ø§Ù„Ø§Ù„ØªØ²Ø§Ù… Ø¨Ø­Ø¯ÙˆØ¯ A4</p>

        <textarea class="input-area" id="screenplay-input" placeholder="Ø£Ø¯Ø®Ù„ Ù†Øµ Ø§Ù„Ø³ÙŠÙ†Ø§Ø±ÙŠÙˆ Ù‡Ù†Ø§...">Ø¨Ø³Ù… Ø§Ù„Ù„Ù‡ Ø§Ù„Ø±Ø­Ù…Ù† Ø§Ù„Ø±Ø­ÙŠÙ…

Ù…Ø´Ù‡Ø¯ 1 Ù„ÙŠÙ„-Ø¯Ø§Ø®Ù„ÙŠ
Ø´Ù‚Ø© Ù‡Ù†Ø¯ ÙÙŠ Ø¨ÙŠØ±ÙˆØª

ØªØ±Ù‚Ø¯ Ù‡Ù†Ø¯ Ø¹Ù„Ù‰ Ø§Ù„Ø³Ø±ÙŠØ± ÙˆÙ‡ÙŠ ØªÙ†Ø¸Ø± Ø¥Ù„Ù‰ Ø§Ù„Ø³Ù‚Ù. Ø§Ù„ØºØ±ÙØ© Ù…Ø¶Ø§Ø¡Ø© Ø¨Ù†ÙˆØ± Ø®Ø§ÙØª Ù…Ù† Ù…ØµØ¨Ø§Ø­ Ø¬Ø§Ù†Ø¨ÙŠ. ØªØ¨Ø¯Ùˆ Ù‚Ù„Ù‚Ø© ÙˆÙ„Ø§ ØªØ³ØªØ·ÙŠØ¹ Ø§Ù„Ù†ÙˆÙ….

Ù‡Ù†Ø¯:
(Ù‡Ø§Ù…Ø³Ø© Ù„Ù†ÙØ³Ù‡Ø§)
Ù„Ø§ Ø£Ø³ØªØ·ÙŠØ¹ Ø§Ù„Ù†ÙˆÙ…... Ù‡Ø°Ø§ Ø§Ù„Ù‚Ù„Ù‚ ÙŠÙ‚ØªÙ„Ù†ÙŠ.

ØªØ¬Ù„Ø³ Ø¹Ù„Ù‰ Ø§Ù„Ø³Ø±ÙŠØ± ÙˆØªÙ…Ø³Ùƒ Ø¨Ù‡Ø§ØªÙÙ‡Ø§ØŒ ØªØªØ±Ø¯Ø¯ Ù‚Ø¨Ù„ Ø£Ù† ØªØ·Ù„Ø¨ Ø±Ù‚Ù…Ø§Ù‹. ØªÙ†Ø¸Ø± Ø¥Ù„Ù‰ Ø§Ù„Ø³Ø§Ø¹Ø© Ø¹Ù„Ù‰ Ø§Ù„Ø·Ø§ÙˆÙ„Ø© Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠØ© - Ù…Ù†ØªØµÙ Ø§Ù„Ù„ÙŠÙ„.

Ù‡Ù†Ø¯:
(ØªØ·Ù„Ø¨ Ø±Ù‚Ù…Ø§Ù‹)
Ø¢Ù„Ùˆ... Ù…Ø§Ù…Ø§ØŸ Ø£Ø¹Ø°Ø±ÙŠÙ†ÙŠ Ø¹Ù„Ù‰ Ø§Ù„Ø§ØªØµØ§Ù„ ÙÙŠ Ù‡Ø°Ø§ Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ù…ØªØ£Ø®Ø±.

ØµÙˆØª Ø§Ù„Ø£Ù… Ù…Ù† Ø§Ù„Ù‡Ø§ØªÙØŒ Ø¯Ø§ÙØ¦ ÙˆÙ…Ø·Ù…Ø¦Ù†. Ù‡Ù†Ø¯ ØªØªÙƒÙ„Ù… Ø¨ØµÙˆØª Ù…Ù†Ø®ÙØ¶.

Ù‡Ù†Ø¯:
Ø£Ù†Ø§ Ø¨Ø®ÙŠØ±ØŒ Ø¨Ø³ Ù…Ø´ Ù‚Ø§Ø¯Ø±Ø© Ø£Ù†Ø§Ù…. Ø¹Ù†Ø¯ÙŠ Ø§Ù…ØªØ­Ø§Ù† Ù…Ù‡Ù… Ø¨ÙƒØ±Ø§ ÙˆØ®Ø§ÙŠÙØ© Ø£ÙƒÙˆÙ† Ù†Ø³ÙŠØª ÙƒÙ„ Ø´ÙŠ.

Ù‚Ø·Ø¹ Ø¥Ù„Ù‰

Ù…Ø´Ù‡Ø¯ 2 Ù†Ù‡Ø§Ø±-Ø®Ø§Ø±Ø¬ÙŠ
Ø§Ù„Ø´Ø§Ø±Ø¹ Ø£Ù…Ø§Ù… Ø§Ù„Ø¬Ø§Ù…Ø¹Ø©

ØµØ¨Ø§Ø­ Ù…Ø´Ù…Ø³ØŒ Ø·Ù„Ø§Ø¨ ÙŠØªØ¬ÙˆÙ„ÙˆÙ† ÙÙŠ Ø§Ù„Ø³Ø§Ø­Ø© Ù…ØªØ¬Ù‡ÙŠÙ† Ø¥Ù„Ù‰ Ù‚Ø§Ø¹Ø§Øª Ø§Ù„Ø§Ù…ØªØ­Ø§Ù†Ø§Øª. Ù‡Ù†Ø¯ ØªØ³ÙŠØ± Ø¨Ø³Ø±Ø¹Ø© ÙˆÙ‡ÙŠ ØªØ­Ù…Ù„ Ø­Ù‚ÙŠØ¨ØªÙ‡Ø§ØŒ ØªØ¨Ø¯Ùˆ Ø£ÙƒØ«Ø± Ø«Ù‚Ø© Ù…Ù† Ø§Ù„Ù„ÙŠÙ„Ø© Ø§Ù„Ù…Ø§Ø¶ÙŠØ©.

ØªÙ„ØªÙ‚ÙŠ Ø¨ØµØ¯ÙŠÙ‚ØªÙ‡Ø§ Ø³Ø§Ø±Ø© Ø¹Ù†Ø¯ Ø§Ù„Ø¨ÙˆØ§Ø¨Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©.

Ø³Ø§Ø±Ø©:
ØµØ¨Ø§Ø­ Ø§Ù„Ø®ÙŠØ± ÙŠØ§ Ù‡Ù†Ø¯! ØªØ¨Ø¯ÙŠÙ† Ù…ØªØ¹Ø¨Ø© Ø´ÙˆÙŠ.

Ù‡Ù†Ø¯:
(ØªØ¨ØªØ³Ù…)
Ù„Ù… Ø£Ù†Ù… Ø¬ÙŠØ¯Ø§Ù‹ Ø§Ù„Ù„ÙŠÙ„Ø© Ø§Ù„Ù…Ø§Ø¶ÙŠØ©ØŒ Ø¨Ø³ Ø£Ø­Ø³Ù† Ù…Ù† Ø£Ù…Ø³.
ÙƒØ§Ù† Ù„Ø¯ÙŠ Ø§Ù„ÙƒØ«ÙŠØ± Ù„Ù„ØªÙÙƒÙŠØ± ÙÙŠÙ‡ØŒ Ø¨Ø³ Ø§Ù„Ø­Ù…Ø¯ Ù„Ù„Ù‡ ÙƒÙ„Ù‡ ØªÙ…Ø§Ù….

Ø³Ø§Ø±Ø©:
(ØªØ±Ø¨Øª Ø¹Ù„Ù‰ ÙƒØªÙÙ‡Ø§)
Ù…Ø§ ØªØ®Ø§ÙÙŠØŒ Ø¥Ù†Øª Ù…Ø­Ø¶Ø±Ø© Ù…Ù†ÙŠØ­. ÙŠØ§Ù„Ù„Ù‡ Ù†Ø±ÙˆØ­ Ù†Ø´Ø±Ø¨ Ù‚Ù‡ÙˆØ© Ù‚Ø¨Ù„ Ø§Ù„Ø§Ù…ØªØ­Ø§Ù†.

ØªØ¯Ø®Ù„Ø§Ù† Ù…Ø¹Ø§Ù‹ Ø¥Ù„Ù‰ Ù…Ø¨Ù†Ù‰ Ø§Ù„Ø¬Ø§Ù…Ø¹Ø© ÙˆØ³Ø· Ø²Ø­Ù…Ø© Ø§Ù„Ø·Ù„Ø§Ø¨. Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§ ØªØªØ¨Ø¹Ù‡Ù…Ø§ ÙˆÙ‡Ù…Ø§ ÙŠÙ…Ø´ÙŠØ§Ù† ÙÙŠ Ø§Ù„Ù…Ù…Ø± Ø§Ù„Ø·ÙˆÙŠÙ„.

Ù‚Ø·Ø¹ Ø¥Ù„Ù‰

Ù…Ø´Ù‡Ø¯ 3 Ø¯Ø§Ø®Ù„ÙŠ-Ù†Ù‡Ø§Ø±
Ù‚Ø§Ø¹Ø© Ø§Ù„Ø§Ù…ØªØ­Ø§Ù†Ø§Øª

Ù‚Ø§Ø¹Ø© ÙƒØ¨ÙŠØ±Ø© Ù…Ù„ÙŠØ¦Ø© Ø¨Ø§Ù„Ø·Ù„Ø§Ø¨ØŒ Ø§Ù„Ø¬Ù…ÙŠØ¹ ÙŠØ­Ø¶Ø± Ø£ÙˆØ±Ø§Ù‚Ù‡ ÙˆØ£Ù‚Ù„Ø§Ù…Ù‡. Ù‡Ù†Ø¯ ØªØ¬Ù„Ø³ ÙÙŠ Ø§Ù„Ù…Ù‚Ø¯Ù…Ø©ØŒ ØªØ£Ø®Ø° Ù†ÙØ³Ø§Ù‹ Ø¹Ù…ÙŠÙ‚Ø§Ù‹ ÙˆØªÙ†Ø¸Ø± Ø­ÙˆÙ„Ù‡Ø§.

Ø§Ù„Ø£Ø³ØªØ§Ø° ÙŠØ¯Ø®Ù„ Ø­Ø§Ù…Ù„Ø§Ù‹ Ø£ÙˆØ±Ø§Ù‚ Ø§Ù„Ø§Ù…ØªØ­Ø§Ù†.

Ø§Ù„Ø£Ø³ØªØ§Ø°:
ØµØ¨Ø§Ø­ Ø§Ù„Ø®ÙŠØ± Ø¬Ù…ÙŠØ¹Ø§Ù‹. Ø¹Ù†Ø¯ÙƒÙ… Ø³Ø§Ø¹ØªÙŠÙ† Ù„Ù„Ø¥Ø¬Ø§Ø¨Ø© Ø¹Ù„Ù‰ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ø³Ø¦Ù„Ø©.
Ø¥Ø°Ø§ ÙÙŠ Ø£ÙŠ Ø§Ø³ØªÙØ³Ø§Ø±ØŒ Ø§Ø±ÙØ¹ÙˆØ§ Ø¥ÙŠØ¯ÙƒÙ….

ÙŠØ¨Ø¯Ø£ ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ø£ÙˆØ±Ø§Ù‚. Ù‡Ù†Ø¯ ØªØ³ØªÙ„Ù… ÙˆØ±Ù‚ØªÙ‡Ø§ ÙˆØªÙ‚Ø±Ø£ Ø§Ù„Ø£Ø³Ø¦Ù„Ø© Ø¨ØªØ±ÙƒÙŠØ².

Ù‡Ù†Ø¯:
(ØªÙÙƒØ± ÙÙŠ Ù†ÙØ³Ù‡Ø§)
Ø§Ù„Ø­Ù…Ø¯ Ù„Ù„Ù‡ØŒ Ø§Ù„Ø£Ø³Ø¦Ù„Ø© ÙˆØ§Ø¶Ø­Ø© ÙˆØ£Ù†Ø§ Ø£Ø¹Ø±Ù Ø¥Ø¬Ø§Ø¨Ø§ØªÙ‡Ø§.

ØªØ¨Ø¯Ø£ Ø¨Ø§Ù„ÙƒØªØ§Ø¨Ø© Ø¨Ø«Ù‚Ø©. Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§ ØªØ¸Ù‡Ø± ØªØ¹Ø§Ø¨ÙŠØ± ÙˆØ¬Ù‡Ù‡Ø§ ÙˆÙ‡ÙŠ ØªÙ†ØªÙ‚Ù„ Ù…Ù† Ø§Ù„Ù‚Ù„Ù‚ Ø¥Ù„Ù‰ Ø§Ù„Ø±Ø§Ø­Ø© ÙˆØ§Ù„Ø«Ù‚Ø©.

Ø§Ù†ØªÙ‡Ø§Ø¡</textarea>

        <div class="controls">
            <button onclick="testPagination()">Ø§Ø®ØªØ¨Ø± Ø§Ù„ØªØ±Ù‚ÙŠÙ…</button>
            <button onclick="clearResults()">Ù…Ø³Ø­ Ø§Ù„Ù†ØªØ§Ø¦Ø¬</button>
        </div>

        <div id="stats" class="stats" style="display: none;"></div>
    </div>

    <div id="pagination-result"></div>

    <script type="module">
        // Simple pagination engine for testing
        class SimplePaginationEngine {
            constructor() {
                this.maxPageHeight = 700; // Approximate content height for A4
            }

            analyzeContent(text) {
                const lines = text.split('\n');
                const elements = [];

                for (let i = 0; i < lines.length; i++) {
                    const line = lines[i].trim();

                    if (!line) {
                        elements.push({
                            type: 'action',
                            content: '',
                            estimatedHeight: 12,
                            lineCount: 1
                        });
                        continue;
                    }

                    if (/^\s*Ø¨Ø³Ù…\s+Ø§Ù„Ù„Ù‡\s+Ø§Ù„Ø±Ø­Ù…Ù†\s+Ø§Ù„Ø±Ø­ÙŠÙ…\s*$/.test(line)) {
                        elements.push({
                            type: 'basmala',
                            content: line,
                            estimatedHeight: 36,
                            lineCount: 1
                        });
                    }
                    else if (line.match(/^(Ù…Ø´Ù‡Ø¯|Ù…\.)\s*\d+/i)) {
                        let sceneContent = line;
                        let lineCount = 1;

                        if (i + 1 < lines.length && lines[i + 1].trim() &&
                            !this.isNewElement(lines[i + 1].trim())) {
                            i++;
                            sceneContent += '\n' + lines[i].trim();
                            lineCount = 2;
                        }

                        elements.push({
                            type: 'scene-header',
                            content: sceneContent,
                            estimatedHeight: lineCount * 18 + 20,
                            lineCount
                        });
                    }
                    else if (this.isTransition(line)) {
                        elements.push({
                            type: 'transition',
                            content: line,
                            estimatedHeight: 24,
                            lineCount: 1
                        });
                    }
                    else if (this.isCharacterName(line)) {
                        let dialogueContent = line;
                        let dialogueHeight = 18;
                        let lineCount = 1;

                        while (i + 1 < lines.length && lines[i + 1].trim() &&
                               !this.isNewElement(lines[i + 1].trim())) {
                            i++;
                            const dialogueLine = lines[i].trim();
                            dialogueContent += '\n' + dialogueLine;
                            lineCount++;

                            if (this.isParenthetical(dialogueLine)) {
                                dialogueHeight += 16;
                            } else {
                                dialogueHeight += 18;
                            }
                        }

                        elements.push({
                            type: 'dialogue',
                            content: dialogueContent,
                            estimatedHeight: dialogueHeight + 15,
                            lineCount
                        });
                    }
                    else {
                        const lineCount = Math.ceil(line.length / 80);
                        elements.push({
                            type: 'action',
                            content: line,
                            estimatedHeight: lineCount * 18 + 6,
                            lineCount
                        });
                    }
                }

                return elements;
            }

            createPages(elements) {
                const pages = [];
                let currentPage = {
                    pageNumber: 1,
                    elements: [],
                    height: 0,
                    overflow: false
                };

                for (const element of elements) {
                    const willOverflow = currentPage.height + element.estimatedHeight > this.maxPageHeight;

                    if (willOverflow && currentPage.elements.length > 0) {
                        pages.push(currentPage);

                        currentPage = {
                            pageNumber: pages.length + 1,
                            elements: [element],
                            height: element.estimatedHeight,
                            overflow: false
                        };
                    } else {
                        currentPage.elements.push(element);
                        currentPage.height += element.estimatedHeight;

                        if (currentPage.height > this.maxPageHeight * 0.95) {
                            currentPage.overflow = true;
                        }
                    }
                }

                if (currentPage.elements.length > 0) {
                    pages.push(currentPage);
                }

                return pages.length > 0 ? pages : [{
                    pageNumber: 1,
                    elements: [],
                    height: 0,
                    overflow: false
                }];
            }

            generateHTML(text) {
                const elements = this.analyzeContent(text);
                const pages = this.createPages(elements);

                let html = '<div class="screenplay-pages">';

                for (const page of pages) {
                    const overflowClass = page.overflow ? ' overflow' : '';
                    html += `<div class="page${overflowClass}" data-page="${page.pageNumber}">`;
                    html += '<div class="page-content">';

                    for (const element of page.elements) {
                        html += this.elementToHTML(element);
                    }

                    html += '</div>';
                    html += `<div class="page-number">${page.pageNumber}</div>`;

                    if (page.overflow) {
                        html += '<div class="page-overflow-indicator">ØªØ¬Ø§ÙˆØ² Ø§Ù„ØµÙØ­Ø©</div>';
                    }

                    html += '</div>';
                }

                html += '</div>';
                return { html, pages };
            }

            elementToHTML(element) {
                const content = this.escapeHtml(element.content);

                switch (element.type) {
                    case 'basmala':
                        return `<div class="basmala">${content}</div>`;

                    case 'scene-header':
                        return this.formatSceneHeader(content);

                    case 'action':
                        return element.content ? `<div class="action">${content}</div>` : '<div class="action"><br></div>';

                    case 'dialogue':
                        return this.formatDialogue(content);

                    case 'transition':
                        return `<div class="transition">${content}</div>`;

                    default:
                        return `<div class="action">${content}</div>`;
                }
            }

            formatSceneHeader(content) {
                const lines = content.split('\n');
                const firstLine = lines[0];
                const secondLine = lines[1] || '';

                const sceneMatch = firstLine.match(/^(Ù…Ø´Ù‡Ø¯|Ù…\.)\s*(\d+)\s*[-â€“â€”]?\s*(.*)/i);
                if (sceneMatch) {
                    const sceneNum = `${sceneMatch[1]} ${sceneMatch[2]}`;
                    const timeLocation = sceneMatch[3] || '';

                    return `
                        <div class="scene-header-container">
                            <div class="scene-header-top-line">
                                <span class="scene-header-1">${this.escapeHtml(sceneNum)}</span>
                                <span class="scene-header-2">${this.escapeHtml(timeLocation)}</span>
                            </div>
                            <div class="scene-header-3">${this.escapeHtml(secondLine)}</div>
                        </div>`;
                }

                return `<div class="scene-header-container">${this.escapeHtml(content)}</div>`;
            }

            formatDialogue(content) {
                const lines = content.split('\n');
                let html = '<div class="dialogue-block">';

                for (let i = 0; i < lines.length; i++) {
                    const line = lines[i].trim();

                    if (i === 0) {
                        html += `<div class="character-name">${this.escapeHtml(line.replace(':', ''))}</div>`;
                    } else if (this.isParenthetical(line)) {
                        html += `<div class="parenthetical">${this.escapeHtml(line)}</div>`;
                    } else {
                        html += `<div class="dialogue-text">${this.escapeHtml(line)}</div>`;
                    }
                }

                html += '</div>';
                return html;
            }

            isCharacterName(line) {
                return /^\s*[\u0600-\u06FF][\u0600-\u06FF\s]{0,40}\s*:\s*$/.test(line);
            }

            isParenthetical(line) {
                return line.match(/^\(.*\)$/) !== null;
            }

            isTransition(line) {
                const patterns = [
                    /^\s*(?:Ù‚Ø·Ø¹|Ø¥Ù„Ù‰|Ø°ÙˆØ¨Ø§Ù†|Ù…Ø²Ø¬|Ù‚Ø·Ø¹ Ø¥Ù„Ù‰|Ø®Ø§Ø±Ø¬ Ø§Ù„Ù…Ø´Ù‡Ø¯|Ø§Ù†ØªÙ‡Ø§Ø¡)\s*$/i
                ];
                return patterns.some(pattern => pattern.test(line));
            }

            isNewElement(line) {
                return (
                    line.match(/^(Ù…Ø´Ù‡Ø¯|Ù…\.)\s*\d+/i) !== null ||
                    this.isTransition(line) ||
                    this.isCharacterName(line) ||
                    /^\s*Ø¨Ø³Ù…\s+Ø§Ù„Ù„Ù‡\s+Ø§Ù„Ø±Ø­Ù…Ù†\s+Ø§Ù„Ø±Ø­ÙŠÙ…\s*$/.test(line)
                );
            }

            escapeHtml(text) {
                const div = document.createElement('div');
                div.textContent = text;
                return div.innerHTML;
            }
        }

        const engine = new SimplePaginationEngine();

        window.testPagination = function() {
            const input = document.getElementById('screenplay-input').value;
            const result = engine.generateHTML(input);

            document.getElementById('pagination-result').innerHTML = result.html;

            // Show stats
            const statsDiv = document.getElementById('stats');
            statsDiv.style.display = 'block';
            statsDiv.innerHTML = `
                ğŸ“Š Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„ØªØ±Ù‚ÙŠÙ…:
                â€¢ Ø¹Ø¯Ø¯ Ø§Ù„ØµÙØ­Ø§Øª: ${result.pages.length}
                â€¢ Ø§Ù„ØµÙØ­Ø§Øª Ø§Ù„ØªÙŠ ØªØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ ÙØ§Ø¦Ø¶: ${result.pages.filter(p => p.overflow).length}
                â€¢ Ù…ØªÙˆØ³Ø· Ø§Ù„Ø§Ø±ØªÙØ§Ø¹ Ù„Ù„ØµÙØ­Ø©: ${Math.round(result.pages.reduce((sum, p) => sum + p.height, 0) / result.pages.length)}px
                â€¢ Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø¹Ù†Ø§ØµØ±: ${result.pages.reduce((sum, p) => sum + p.elements.length, 0)}
            `;
        };

        window.clearResults = function() {
            document.getElementById('pagination-result').innerHTML = '';
            document.getElementById('stats').style.display = 'none';
        };

        // Auto test on load
        window.testPagination();
    </script>
</body>
</html>